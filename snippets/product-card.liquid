{%- if product_card_product and product_card_product != empty -%}
{%- liquid
	assign products_hover_images = settings.products_hover_images
	assign products_hover_images_count = settings.products_hover_images_count
	assign product_aspect_ratio = settings.product_aspect_ratio
	assign featured_media = product_card_product.featured_media
	assign ratio = 1
	assign sizes = '375x375,770x770'
	assign is_video = false
	assign use_video = settings.products_use_video


	if featured_media.media_type != 'image'
		if featured_media.media_type == 'video' and use_video
			assign is_video = true
			assign featured_media = featured_media
		else
			assign featured_media = featured_media.preview_image
		endif
	endif
	if product_aspect_ratio == 'adapt'
		if featured_media
			assign ratio = featured_media.aspect_ratio
		endif
		assign sizes = '375x0,770x0'
	elsif product_aspect_ratio == 'portrait'
		assign ratio = 1 | divided_by: 1.25
		assign sizes = '375x350,770x700'
	elsif product_aspect_ratio == 'landscape'
		assign ratio = 1 | divided_by: 0.75
		assign sizes = '375x250,770x500'
	endif
	assign product_content_alignment = settings.product_content_alignment

	assign is_purchasable = false
	if product_card_product.available and product_card_product.variants.size == 1
		assign is_purchasable = true
	endif

	# Product card options
	assign show_size_options = settings.show_size_options
	assign size_options_variant_name = settings.size_options_variant_name
	assign size_options_limit = settings.size_options_limit

-%}
<product-card class="product-card text-{{ product_content_alignment }}">
  <figure class="product-featured-image {% if products_hover_images and product_card_product.images.size > 1 and products_hover_images_count > 0 %}thb-hover{% endif %}">
    {% render 'product-card-badge', product_card_product: product_card_product %}

    <a href="{{ product_card_product.url | within: collection }}" title="{{ product_card_product.title | escape }}" class="product-featured-image-link aspect-ratio aspect-ratio--{{ settings.product_aspect_ratio }}" style="--padding-bottom: {{ 1 | divided_by: ratio | times: 100 }}%;">
      {%- if products_hover_images and product_card_product.images.size > 1 -%}
        {%- for i in (1..products_hover_images_count) -%}
					{%- if product_card_product.images[i] -%}
	          {%- render 'responsive-image', class: 'product-secondary-image', image: product_card_product.images[i], sizes: sizes, priority: 'low', defer: true -%}
		      {%- endif -%}
        {%- endfor %}
      {%- endif -%}
			{%- if featured_media -%}
      	{%- if is_video and use_video -%}
					{{ featured_media | video_tag: controls: false, loading: 'lazy', loop: true, autoplay: true, image_size: '770x' }}
				{%- else -%}
      	{%- render 'responsive-image', class: 'product-primary-image', image: featured_media, sizes: sizes -%}
				{%- endif -%}
			{%- else -%}
				<div class="thb-placeholder">
					{{ 'product-1' | placeholder_svg_tag }}
				</div>
			{%- endif -%}
    </a>
		{%- if settings.enable_quick_view -%}
		<quick-view class="product-card-quickview product-card-quickview--{%- unless show_size_options -%}button{%- else -%}icon{%- endunless -%}" data-product-handle="{{ product_card_product.handle }}" tabindex="-1">
			<div class="loading-overlay">{% render 'svg-icons' with 'thb-loading' %}</div>
			<span>{%- unless show_size_options -%}{{ 'products.product.quick_view' | t }}{%- else -%}{% render 'svg-icons' with 'thb-quick-view' %}{%- endunless -%}</span>
		</quick-view>
		{%- endif -%}
		{%- if show_size_options -%}
			{%- render 'product-card-size-options', product_card_product: product_card_product -%}
		{%- endif -%}
		{%- if products_hover_images and product_card_product.images.size > 1 and settings.products_hover_dots -%}
			<ul class="product-secondary-images-nav">
			{%- for i in (1..products_hover_images_count) -%}
				{%- if product_card_product.images[i] -%}
				<li></li>
				{%- endif -%}
			{%- endfor %}
			</ul>
		{%- endif -%}
  </figure>
	<div class="product-card-info">
		{%- if settings.show_products_vendor -%}
		<div class="product-card-vendor"><a href="{{ product_card_product.vendor | url_for_vendor }}" title="{{ product_card_product.vendor | escape }}">{{ product_card_product.vendor }}</a></div>
		{%- endif -%}
  	<a href="{{ product_card_product.url | within: collection }}" title="{{ product_card_product.title | escape }}" class="product-card-title">{{ product_card_product.title }}</a>
		{% if product_card_product.metafields.custom.short_description != blank %}
			<p class="product-description">{{ product_card_product.metafields.custom.short_description }}</p>
		{% endif %}

		{%- if settings.show_products_rating and product_card_product.metafields.loox.avg_rating != blank -%}
			<div class="loox-rating" data-id="{{ product_card_product.id }}" data-rating="{{ product_card_product.metafields.loox.avg_rating }}" data-raters="{{ product_card_product.metafields.loox.num_reviews }}"></div>
		{%- endif -%}

    {% render 'product-price', product: product_card_product %}
		{% render 'product-card-swatch', product: product_card_product, sizes: sizes %}
		{%- if settings.show_products_subtitle and product_card_product.metafields.descriptors.subtitle != blank -%}
			<p class="product-card-subtitle">{{ product_card_product.metafields.descriptors.subtitle }}</p>
		{%- endif -%}
		{%- if settings.enable_quick_add -%}
			{%- liquid
				assign button_tag = 'button'
				if product_card_product.selected_or_first_available_variant.available == false
					assign button_content = 'products.product.sold_out' | t
				else
					if product_card_product.metafields.theme.preorder and product_card_product.available
						assign button_content = 'products.product.pre_order' | t
					else
						if is_purchasable
							assign button_content = 'products.product.add_to_cart' | t
						else
							assign button_content = 'products.product.choose_options' | t
						endif
					endif

					unless is_purchasable
						assign button_tag = 'quick-view'
					endunless
				endif
			-%}
			<div class="product-card--add-to-cart-button-container">
				<{{ button_tag }} class="product-card--add-to-cart-button{% if settings.product_card_quick_add_style == 'outline' %} outline{% endif %}{% if is_purchasable %} product-card--add-to-cart-button-simple{% endif %} button accent" data-product-id="{{ product_card_product.selected_or_first_available_variant.id }}" data-product-handle="{{ product_card_product.handle }}" tabindex="-1" {% if product_card_product.selected_or_first_available_variant.available == false %}disabled{% endif %}>
					<span class="loading-overlay">{% render 'svg-icons' with 'thb-loading' %}</span>
					<span class="product-card--add-to-cart-text">{{ button_content }}</span>
				</{{ button_tag }}>
			</div>
		{%- endif -%}
		{%- if settings.enable_price -%}
			{% if product_card_product.metafields.custom.volume_in_ml != blank %}
        <div class="volume-ml">
          {% assign price = product_card_product.price %}
          {% assign volume = product_card_product.metafields.custom.volume_in_ml.value | plus: 0.0 %}

            {% assign price_per_ml = price | divided_by: volume %}
            {% assign price_per_100ml_cents = price_per_ml | times: 100 %}

            <div class="price-per-100ml">
              מחיר ל100 מ"ל: {{ price_per_100ml_cents | money }}
            </div>
        </div>
      {% endif %}

      {% if product_card_product.metafields.custom.volume_in_grams != blank %}
        <div class="volume-ml">
          {% assign price = product_card_product.price %}
          {% assign volume = proproduct_card_productduct.metafields.custom.volume_in_grams.value | plus: 0.0 %}

            {% assign price_per_ml = price | divided_by: volume %}
            {% assign price_per_100ml_cents = price_per_ml | times: 100 %}

            <div class="price-per-100ml">
              מחיר ל100 גרם: {{ price_per_100ml_cents | money }}
            </div>
        </div>
      {% endif %}
		{%- endif -%}
  </div>
</product-card>
{%- else -%}
<product-card class="product-card">
	<figure class="product-featured-image {% if settings.products_hover_images %}thb-hover{% endif %}">
		<a href="{{ product_card_product.url | within: collection }}" title="{{ product_card_product.title | escape }}" class="product-featured-image-link aspect-ratio aspect-ratio--{{ settings.product_aspect_ratio }}" style="--padding-bottom: {{ 1 | divided_by: 1 | times: 100 }}%;">
			<div class="thb-placeholder">
				{{ 'product-1' | placeholder_svg_tag }}
			</div>
			<button class="product-card-quickview  product-card-quickview--{%- unless show_size_options -%}button{%- else -%}icon{%- endunless -%}" data-product-handle="{{ product_card_product.handle }}" tabindex="-1">
				<div class="loading-overlay">{% render 'svg-icons' with 'thb-loading' %}</div>
				<span>{{ 'products.product.quick_view' | t }}</span>
			</button>
		</a>
	</figure>
	<div class="product-card-info">
		<div class="product-card-vendor"><a href="#" title="{{ 'onboarding.product_vendor' | t }}">{{ 'onboarding.product_vendor' | t }}</a></div>
		<a href="#" title="{{ product_card_product.title | escape }}" class="product-card-title">{{ 'onboarding.product_title' | t }}</a>
		{% if product_card_product.metafields.custom.short_description != blank %}
			<p class="product-description">{{ product_card_product.metafields.custom.short_description }}</p>
		{% endif %}
		{% render 'product-price', product: product_card_product %}
		<div class="loox-rating" data-id="{{ product_card_product.id }}" data-rating="{{ product_card_product.metafields.loox.avg_rating }}" data-raters="{{ product_card_product.metafields.loox.num_reviews }}"></div>
		{%- if settings.enable_quick_add -%}
		<div class="product-card--add-to-cart-button-container">
			<quick-view class="product-card--add-to-cart-button button{% if settings.product_card_quick_add_style == 'outline' %} outline{% endif %}" data-product-handle="" tabindex="-1" disabled>
				<span class="loading-overlay">{% render 'svg-icons' with 'thb-loading' %}</span>
				<span class="product-card--add-to-cart-text">{{ 'products.product.choose_options' | t }}</span>
			</quick-view>
		</div>
		{%- endif -%}
		{%- if settings.enable_price -%}
			{% if product_card_product.metafields.custom.volume_in_ml != blank %}
        <div class="volume-ml">
          {% assign price = product_card_product.price %}
          {% assign volume = product_card_product.metafields.custom.volume_in_ml.value | plus: 0.0 %}

            {% assign price_per_ml = price | divided_by: volume %}
            {% assign price_per_100ml_cents = price_per_ml | times: 100 %}

            <div class="price-per-100ml">
              מחיר ל100 מ"ל: {{ price_per_100ml_cents | money }}
            </div>
        </div>
      {% endif %}

      {% if product_card_product.metafields.custom.volume_in_grams != blank %}
        <div class="volume-ml">
          {% assign price = product_card_product.price %}
          {% assign volume = proproduct_card_productduct.metafields.custom.volume_in_grams.value | plus: 0.0 %}

            {% assign price_per_ml = price | divided_by: volume %}
            {% assign price_per_100ml_cents = price_per_ml | times: 100 %}

            <div class="price-per-100ml">
              מחיר ל100 גרם: {{ price_per_100ml_cents | money }}
            </div>
        </div>
      {% endif %}
		{%- endif -%}
	</div>
</product-card>
{%- endif -%}
